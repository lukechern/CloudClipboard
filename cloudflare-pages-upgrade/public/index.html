<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>云剪贴板</title>
    <link rel="stylesheet" href="css/base.css">
    <link rel="stylesheet" href="css/form.css">
    <link rel="stylesheet" href="css/records.css">
    <link rel="stylesheet" href="css/components.css">
    <link rel="stylesheet" href="css/toolbar.css">
    <link rel="stylesheet" href="css/responsive.css">
    <link rel="stylesheet" href="css/auth.css">
</head>

<body>
    <div class="container">
        <div class="header">
            <h1>云剪贴板</h1>
            <p>跨设备同步您的文本内容</p>
        </div>

        <div class="content">
            <div class="input-section">
                <form id="content-form">
                    <div class="textarea-container">
                        <textarea id="content-input" name="content" placeholder="在此输入您要保存的文本内容..." required></textarea>
                        <button type="button" class="clear-btn" id="clearBtn" title="清空内容">
                            <img src="img/clear.svg" alt="清空" width="24" height="24">
                        </button>
                    </div>
                    <button type="submit">发送到云端</button>
                </form>
            </div>

            <div class="records-section">
                <div class="records-header">
                    <h2>历史记录</h2>
                    <div class="tab-container">
                        <button class="tab-btn active" data-filter="cache">缓存</button>
                        <button class="tab-btn" data-filter="archived">存档</button>
                    </div>
                </div>
                <div id="records-loading" class="records-loading" style="display: none;">
                    <img src="img/spinner.svg" class="spinner" alt="Loading">
                    <span>载入中...</span>
                </div>
                <div id="records-container">
                    <!-- 记录将通过JavaScript动态加载 -->
                </div>
            </div>
        </div>
    </div>

    <!-- 存储位置信息 -->
    <div class="storage-info">
        <div id="storage-info-container">
            <!-- 存储信息将通过JavaScript动态加载 -->
        </div>
    </div>

    <div id="notification" class="notification">已复制到剪贴板</div>

    <!-- 确认对话框容器 -->
    <div id="modal-container"></div>

    <!-- 回到顶部按钮 -->
    <div class="back-to-top" id="backToTop" title="回到顶部"></div>

    <!-- 批量操作按钮 -->
    <div class="batch-operation" id="batchOperation" title="批量操作">
        <img src="img/operation.svg" alt="批量操作" width="24" height="24">
    </div>

    <script src="js/auth.js"></script>
    <script src="js/utils.js"></script>
    <script src="js/content.js"></script>
    <script src="js/batch.js"></script>
    <script src="js/main.js"></script>

    <!-- Layout Debug Script -->
    <script>
        function debugToolbarLayout() {
            const batchToolbar = document.getElementById('batchToolbar');
            if (!batchToolbar || !batchToolbar.classList.contains('show')) {
                console.error("错误：批量操作工具栏 (batchToolbar) 不可见。");
                return;
            }

            const actionsContainers = batchToolbar.querySelectorAll('.actions');
            const leftActions = actionsContainers[0];
            const rightActions = actionsContainers[1];
            const deleteButton = rightActions ? rightActions.querySelector('.delete-btn') : null;

            if (!leftActions || !rightActions || !deleteButton) {
                console.error("错误：无法找到一个或多个关键子元素 (.actions, .delete-btn)。");
                return;
            }

            const toolbarRect = batchToolbar.getBoundingClientRect();
            const rightActionsRect = rightActions.getBoundingClientRect();
            const deleteButtonRect = deleteButton.getBoundingClientRect();
            const windowWidth = window.innerWidth;

            const toolbarStyles = window.getComputedStyle(batchToolbar);

            console.clear();
            console.log("%c--- Layout Debug Info ---", "color: blue; font-weight: bold;");
            console.log(`Window Width: ${windowWidth}px`);
            console.log("--- 1. Toolbar (#batchToolbar) ---");
            console.log(`X: ${toolbarRect.x.toFixed(2)}px`);
            console.log(`Right: ${toolbarRect.right.toFixed(2)}px`);
            console.log(`Width: ${toolbarRect.width.toFixed(2)}px`);
            console.log(`CSS 'width': ${toolbarStyles.width}`);
            console.log(`CSS 'padding-left': ${toolbarStyles.paddingLeft}`);
            console.log(`CSS 'padding-right': ${toolbarStyles.paddingRight}`);
            console.log("--- 2. Right Actions Container ---");
            console.log(`X: ${rightActionsRect.x.toFixed(2)}px`);
            console.log(`Right: ${rightActionsRect.right.toFixed(2)}px`);
            console.log(`Width: ${rightActionsRect.width.toFixed(2)}px`);
            console.log("--- 3. Delete Button (.delete-btn) ---");
            console.log(`X: ${deleteButtonRect.x.toFixed(2)}px`);
            console.log(`Right: ${deleteButtonRect.right.toFixed(2)}px`);
            console.log(`Width: ${deleteButtonRect.width.toFixed(2)}px`);
            console.log("%c--- Analysis ---", "color: blue; font-weight: bold;");

            const effectiveToolbarRightEdge = toolbarRect.right - parseFloat(toolbarStyles.paddingRight);
            const overflow = rightActionsRect.right - effectiveToolbarRightEdge;

            console.log(`Toolbar's effective right edge (Right - padding-right): ~${effectiveToolbarRightEdge.toFixed(2)}px`);
            console.log(`Right Actions container's right edge is at: ${rightActionsRect.right.toFixed(2)}px`);

            if (Math.abs(overflow) < 1) {
                console.log("✅ [Conclusion 1] The right actions container aligns with its parent's right padding edge, as expected with 'space-between'.");
            } else {
                console.error(`❌ [Conclusion 1] The right actions container overflows its parent's padding box by ${overflow.toFixed(2)}px.`);
            }

            const spaceBetweenToolbarAndWindow = windowWidth - toolbarRect.right;
            console.log(`[Info] Space between toolbar's right edge and window's right edge: ${spaceBetweenToolbarAndWindow.toFixed(2)}px.`);
            console.log("This space is the expected blank margin created by the toolbar's 'width' and 'margin: auto'.");
        }

        const observerTarget = document.body;
        const observer = new MutationObserver((mutationsList, observer) => {
            for(const mutation of mutationsList) {
                if (mutation.type === 'childList') {
                    for (const node of mutation.addedNodes) {
                        if (node.id === 'batchToolbar') {
                            const toolbarObserver = new MutationObserver(() => {
                                if (node.classList.contains('show')) {
                                    debugToolbarLayout();
                                }
                            });
                            toolbarObserver.observe(node, { attributes: true, attributeFilter: ['class'] });
                        }
                    }
                }
            }
        });
        observer.observe(observerTarget, { childList: true });
    </script>
</body>

</html>