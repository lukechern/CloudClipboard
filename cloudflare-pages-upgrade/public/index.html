<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>云剪贴板</title>
    <link rel="stylesheet" href="css/base.css">
    <link rel="stylesheet" href="css/form.css">
    <link rel="stylesheet" href="css/records.css">
    <link rel="stylesheet" href="css/components.css">
    <link rel="stylesheet" href="css/toolbar.css">
    <link rel="stylesheet" href="css/responsive.css">
    <link rel="stylesheet" href="css/auth.css">
</head>

<body>
    <div class="container">
        <div class="header">
            <h1>云剪贴板</h1>
            <p>跨设备同步您的文本内容</p>
        </div>

        <div class="content">
            <div class="input-section">
                <form id="content-form">
                    <div class="textarea-container">
                        <textarea id="content-input" name="content" placeholder="在此输入您要保存的文本内容..." required></textarea>
                        <button type="button" class="clear-btn" id="clearBtn" title="清空内容">
                            <img src="img/clear.svg" alt="清空" width="24" height="24">
                        </button>
                    </div>
                    <button type="submit">发送到云端</button>
                </form>
            </div>

            <div class="records-section">
                <div class="records-header">
                    <h2>历史记录</h2>
                    <div class="tab-container">
                        <button class="tab-btn active" data-filter="cache">缓存</button>
                        <button class="tab-btn" data-filter="archived">存档</button>
                    </div>
                </div>
                <div id="records-loading" class="records-loading" style="display: none;">
                    <img src="img/spinner.svg" class="spinner" alt="Loading">
                    <span>载入中...</span>
                </div>
                <div id="records-container">
                    <!-- 记录将通过JavaScript动态加载 -->
                </div>
            </div>
        </div>
    </div>

    <!-- 存储位置信息 -->
    <div class="storage-info">
        <div id="storage-info-container">
            <!-- 存储信息将通过JavaScript动态加载 -->
        </div>
    </div>

    <div id="notification" class="notification">已复制到剪贴板</div>

    <!-- 确认对话框容器 -->
    <div id="modal-container"></div>

    <!-- 回到顶部按钮 -->
    <div class="back-to-top" id="backToTop" title="回到顶部"></div>

    <!-- 批量操作按钮 -->
    <div class="batch-operation" id="batchOperation" title="批量操作">
        <img src="img/operation.svg" alt="批量操作" width="24" height="24">
    </div>

    <script src="js/auth.js"></script>
    <script src="js/utils.js"></script>
    <script src="js/content.js"></script>
    <script src="js/batch.js"></script>
    <script src="js/main.js"></script>

    <!-- 底部工具条布局调试脚本 -->
    <script>
        function debugToolbarLayout() {
            const batchToolbar = document.getElementById('batchToolbar');
            if (!batchToolbar || !batchToolbar.classList.contains('show')) {
                console.error("错误：批量操作工具栏不可见");
                return;
            }

            const actionsContainers = batchToolbar.querySelectorAll('.actions');
            const leftActions = actionsContainers[0];  // 选择信息显示div
            const rightActions = actionsContainers[1]; // 删除按钮div
            const deleteButton = rightActions ? rightActions.querySelector('.delete-btn') : null;

            if (!leftActions || !rightActions || !deleteButton) {
                console.error("错误：无法找到关键元素");
                return;
            }

            // 获取各元素的位置和尺寸信息
            const toolbarRect = batchToolbar.getBoundingClientRect();
            const leftActionsRect = leftActions.getBoundingClientRect();
            const rightActionsRect = rightActions.getBoundingClientRect();
            const deleteButtonRect = deleteButton.getBoundingClientRect();

            // 获取工具条的计算样式
            const toolbarStyles = window.getComputedStyle(batchToolbar);
            const deleteButtonStyles = window.getComputedStyle(deleteButton);

            console.clear();
            console.log("%c=== 底部工具条布局调试信息 ===", "color: #667eea; font-weight: bold; font-size: 14px;");

            // 基础信息
            console.log(`窗口宽度: ${window.innerWidth}px`);
            console.log(`1. 底部工具条实际视觉宽度: ${toolbarRect.width.toFixed(2)}px`);
            console.log(`2. 底部工具条左上角x轴: ${toolbarRect.left.toFixed(2)}px, 右上角x轴: ${toolbarRect.right.toFixed(2)}px`);

            // 工具条内边距信息
            console.log(`%c--- 工具条内边距信息 ---`, "color: #f39c12; font-weight: bold;");
            console.log(`工具条左内边距: ${toolbarStyles.paddingLeft}`);
            console.log(`工具条右内边距: ${toolbarStyles.paddingRight}`);
            console.log(`工具条有效内容区域右边缘: ${(toolbarRect.right - parseFloat(toolbarStyles.paddingRight)).toFixed(2)}px`);

            // Actions容器信息
            console.log(`%c--- Actions容器信息 ---`, "color: #e74c3c; font-weight: bold;");
            console.log(`3. 第一个actions容器宽度: ${leftActionsRect.width.toFixed(2)}px`);
            console.log(`   第二个actions容器宽度: ${rightActionsRect.width.toFixed(2)}px`);
            console.log(`4. 第一个actions左上角x轴: ${leftActionsRect.left.toFixed(2)}px, 右上角x轴: ${leftActionsRect.right.toFixed(2)}px`);
            console.log(`5. 第二个actions左上角x轴: ${rightActionsRect.left.toFixed(2)}px, 右上角x轴: ${rightActionsRect.right.toFixed(2)}px`);

            // 删除按钮详细信息
            console.log(`%c--- 删除按钮详细信息 ---`, "color: #9b59b6; font-weight: bold;");
            console.log(`6. 删除按钮宽度: ${deleteButtonRect.width.toFixed(2)}px, 右上角x轴: ${deleteButtonRect.right.toFixed(2)}px`);
            console.log(`删除按钮左内边距: ${deleteButtonStyles.paddingLeft}`);
            console.log(`删除按钮右内边距: ${deleteButtonStyles.paddingRight}`);
            console.log(`删除按钮边框: ${deleteButtonStyles.border}`);

            // 溢出检测
            console.log(`%c--- 溢出检测 ---`, "color: #e67e22; font-weight: bold;");
            const toolbarContentRight = toolbarRect.right - parseFloat(toolbarStyles.paddingRight);
            const deleteButtonOverflow = deleteButtonRect.right - toolbarContentRight;
            const rightActionsOverflow = rightActionsRect.right - toolbarContentRight;

            console.log(`删除按钮是否溢出: ${deleteButtonOverflow > 0 ? '是' : '否'} (溢出${deleteButtonOverflow.toFixed(2)}px)`);
            console.log(`右侧Actions容器是否溢出: ${rightActionsOverflow > 0 ? '是' : '否'} (溢出${rightActionsOverflow.toFixed(2)}px)`);

            // 间距分析
            console.log(`%c--- 间距分析 ---`, "color: #27ae60; font-weight: bold;");
            console.log(`左右Actions容器间距: ${(rightActionsRect.left - leftActionsRect.right).toFixed(2)}px`);
            console.log(`工具条右边缘到屏幕右边缘距离: ${(window.innerWidth - toolbarRect.right).toFixed(2)}px`);

            console.log("%c=== 调试信息结束 ===", "color: #667eea; font-weight: bold;");
        }

        // 监听工具栏显示状态变化
        const observerTarget = document.body;
        const observer = new MutationObserver((mutationsList, observer) => {
            for (const mutation of mutationsList) {
                if (mutation.type === 'childList') {
                    for (const node of mutation.addedNodes) {
                        if (node.id === 'batchToolbar') {
                            const toolbarObserver = new MutationObserver(() => {
                                if (node.classList.contains('show')) {
                                    debugToolbarLayout();
                                }
                            });
                            toolbarObserver.observe(node, { attributes: true, attributeFilter: ['class'] });
                        }
                    }
                }
            }
        });
        observer.observe(observerTarget, { childList: true });
    </script>
</body>

</html>